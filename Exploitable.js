import React, { Fragment, Component } from 'react'

class Zone extends Component {
  getZoneStyles() {
    return {
      // backgroundColor: 'rgba(0,0,0,.8)',
      position: 'absolute',
      fontSize: `${100 * this.props.fontFactor}vh`,
      display: 'flex',
      width: this.props.width,
      height: this.props.height,
      top: this.props.top,
      left: this.props.left,
      color: this.props.color,
      alignItem: 'center',
      justifyContent: 'center',
      flexDirection: 'column',
      textAlign: 'center',
      fontFamily: 'sans-serif',
      ...this.props.style
    }
  }

  render() {
    return (
      <div className='zone' style={this.getZoneStyles()}>
        {this.props.children}
      </div>
    )
  }
}

Zone.defaultProps = {
  color: 'white',
  width: '100%',
  height: '100%',
  top: '0',
  left: '0',
  style: {}
}

class Exploitable extends Component {

  constructor(props) {
    super(props)
    this.state = {
      naturalHeight: null,
      naturalWidth: null
    }
  }

  onImageLoad(e) {
    this.setState({
      naturalHeight: e.target.naturalHeight,
      naturalWidth: e.target.naturalWidth
    })
  }

  getStyle() {
    const {naturalWidth, naturalHeight} = this.state
    const ratio = naturalWidth / naturalHeight
    return {
      height: `100vh`,
      width: `${ratio * 100}vh`,
      backgroundImage: `url(${this.props.img})`,
      transform: 'translate(0px, 0px)',
      backgroundSize: 'cover',
      overflow: 'hidden'
    }
  }

  render() {
    const onLoad = this.onImageLoad.bind(this)
    return (
      <Fragment>
        <img onLoad={onLoad} src={this.props.img} style={{display: 'none'}}/>
        <div style={this.getStyle()}>
          {this.props.zones.map((zone, index) => <Zone key={index} fontFactor={this.props.fontFactor} {...{color: this.props.color, ...zone}}/>)}
        </div>
      </Fragment>
    )
  }
}

Exploitable.defaultProps = {
  fontFactor: 0.05,
  zones: [],
  color: 'white'
}

export default Exploitable
